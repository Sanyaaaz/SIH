<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard - InternshipHub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-primary': '#4F46E5',
                        'brand-secondary': '#F97316',
                        'brand-success': '#10B981',
                        'brand-heading': '#1F2937',
                        'brand-text': '#6B7280'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <h1 class="text-xl font-bold text-brand-primary">InternshipHub</h1>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-brand-text">Welcome, <%= user.name %></span>
                    <a href="/auth/logout" class="text-brand-text hover:text-brand-primary">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
        <!-- Welcome Section -->
        <div class="mb-8">
            <h1 class="text-2xl font-bold text-brand-heading">Welcome back, <%= user.name %>!</h1>
            <p class="text-brand-text mt-1">Discover amazing internship opportunities tailored for you.</p>
        </div>

        <!-- Quick Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow-sm p-6 border border-gray-200 hover:shadow-md transition-shadow">
                <div class="flex items-center">
                    <div class="p-2 bg-brand-primary bg-opacity-10 rounded-lg">
                        <i class="fas fa-briefcase text-brand-primary text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-brand-text">Available Internships</p>
                        <p class="text-2xl font-bold text-brand-heading" id="total-internships">-</p>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-sm p-6 border border-gray-200 hover:shadow-md transition-shadow">
                <div class="flex items-center">
                    <div class="p-2 bg-brand-secondary bg-opacity-10 rounded-lg">
                        <i class="fas fa-paper-plane text-brand-secondary text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-brand-text">Applications Sent</p>
                        <p class="text-2xl font-bold text-brand-heading">0</p>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-sm p-6 border border-gray-200 hover:shadow-md transition-shadow">
                <div class="flex items-center">
                    <div class="p-2 bg-brand-success bg-opacity-10 rounded-lg">
                        <i class="fas fa-star text-brand-success text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-brand-text">Profile Score</p>
                        <p class="text-2xl font-bold text-brand-heading">85%</p>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-sm p-6 border border-gray-200 hover:shadow-md transition-shadow">
                <div class="flex items-center">
                    <div class="p-2 bg-purple-100 rounded-lg">
                        <i class="fas fa-bookmark text-purple-600 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-brand-text">Saved</p>
                        <p class="text-2xl font-bold text-brand-heading">0</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Latest Internships -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h2 class="text-lg font-semibold text-brand-heading">Latest Internships</h2>
                    <button onclick="loadAllInternships()" class="text-brand-primary hover:text-brand-primary/80 text-sm font-medium transition-colors">
                        Load More <i class="fas fa-arrow-right ml-1"></i>
                    </button>
                </div>
            </div>
            
            <div class="p-6">
                <div id="internships-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Server-side rendered internships -->
                    <% if (typeof internships !== 'undefined' && internships && internships.length > 0) { %>
                        <% internships.forEach(internship => { %>
                            <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                                <div class="flex justify-between items-start mb-3">
                                    <h3 class="text-lg font-semibold text-brand-heading"><%= internship.title %></h3>
                                    <button class="text-gray-400 hover:text-brand-primary">
                                        <i class="fas fa-bookmark"></i>
                                    </button>
                                </div>
                                
                                <div class="mb-3">
                                    <p class="text-sm text-brand-text">
                                        <% if (internship.company && internship.company.name) { %>
                                            <%= internship.company.name %>
                                        <% } else { %>
                                            Company Name Not Available
                                        <% } %>
                                    </p>
                                    <p class="text-xs text-brand-text mt-1">
                                        <i class="fas fa-map-marker-alt mr-1"></i>
                                        <%= internship.location || 'Remote' %>
                                    </p>
                                </div>
                                
                                <p class="text-sm text-brand-text mb-4" style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                                    <%= internship.description.substring(0, 100) %>...
                                </p>
                                
                                <div class="flex justify-between items-center mb-4">
                                    <span class="text-sm font-medium text-brand-heading">
                                        <% if (internship.stipend && internship.stipend !== '0') { %>
                                            â‚¹<%= internship.stipend %>/month
                                        <% } else { %>
                                            Unpaid
                                        <% } %>
                                    </span>
                                    <span class="text-xs text-brand-text">
                                        <%= internship.duration %>
                                    </span>
                                </div>
                                
                                <div class="flex space-x-2">
                                    <button class="flex-1 bg-brand-primary text-white text-sm py-2 px-4 rounded-md hover:bg-brand-primary/90 transition-colors">
                                        Apply Now
                                    </button>
                                    <button class="px-3 py-2 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors">
                                        <i class="fas fa-share-alt text-brand-text"></i>
                                    </button>
                                </div>
                            </div>
                        <% }) %>
                    <% } else { %>
                        <div class="col-span-full text-center py-12">
                            <div class="max-w-md mx-auto">
                                <i class="fas fa-briefcase text-6xl text-gray-300 mb-4"></i>
                                <h3 class="text-lg font-medium text-brand-heading mb-2">No internships available right now</h3>
                                <p class="text-brand-text mb-4">Don't worry! New opportunities are posted regularly. Check back soon or click "Load More" to refresh.</p>
                                <button onclick="loadAllInternships()" class="bg-brand-primary text-white px-4 py-2 rounded-md hover:bg-brand-primary/90 transition-colors">
                                    <i class="fas fa-refresh mr-2"></i>Refresh Internships
                                </button>
                            </div>
                        </div>
                    <% } %>
                </div>
                
                <!-- Loading indicator -->
                <div id="loading" class="hidden text-center py-4">
                    <i class="fas fa-spinner fa-spin text-brand-primary text-xl"></i>
                    <p class="text-brand-text mt-2">Loading internships...</p>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Update total internships count
        document.addEventListener('DOMContentLoaded', function() {
            const totalElement = document.getElementById('total-internships');
            // if (totalElement) {
            //     const internshipsCount =  (typeof internships !== 'undefined' && internships && internships.length) ? internships.length : 0 ;
            //     totalElement.textContent = internshipsCount;
            // }
            if (totalElement) {
                fetch('/api/internships')
                    .then(response => response.json())
                    .then(data => {
                        if (data.internships) {
                            totalElement.textContent = data.internships.length;
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching internships count:', error);
                        totalElement.textContent = '0';
                    });
            }

        });

        // Load all internships via API
        async function loadAllInternships() {
            const container = document.getElementById('internships-container');
            const loading = document.getElementById('loading');
            
            loading.classList.remove('hidden');
            
            try {
                const response = await fetch('/api/internships');
                const data = await response.json();
                
                if (response.ok && data.internships) {
                    // Clear container
                    container.innerHTML = '';
                    
                    // Update total count
                    document.getElementById('total-internships').textContent = data.internships.length;
                    
                    if (data.internships.length === 0) {
                        container.innerHTML = `
                            <div class="col-span-full text-center py-12">
                                <i class="fas fa-briefcase text-6xl text-gray-300 mb-4"></i>
                                <h3 class="text-lg font-medium text-brand-heading mb-2">No internships available</h3>
                                <p class="text-brand-text">Check back later for new opportunities!</p>
                            </div>
                        `;
                    } else {
                        // Render internships
                        data.internships.forEach(internship => {
                            const internshipCard = createInternshipCard(internship);
                            container.appendChild(internshipCard);
                        });
                    }
                } else {
                    throw new Error('Failed to load internships');
                }
            } catch (error) {
                console.error('Error loading internships:', error);
                container.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <i class="fas fa-exclamation-circle text-6xl text-red-300 mb-4"></i>
                        <h3 class="text-lg font-medium text-brand-heading mb-2">Error loading internships</h3>
                        <p class="text-brand-text">Please try again later.</p>
                    </div>
                `;
            } finally {
                loading.classList.add('hidden');
            }
        }

        // Create internship card element
        function createInternshipCard(internship) {
            const card = document.createElement('div');
            card.className = 'border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow';
            
            card.innerHTML = `
                <div class="flex justify-between items-start mb-3">
                    <h3 class="text-lg font-semibold text-brand-heading">${internship.title}</h3>
                    <button class="text-gray-400 hover:text-brand-primary">
                        <i class="fas fa-bookmark"></i>
                    </button>
                </div>
                
                <div class="mb-3">
                    <p class="text-sm text-brand-text">${internship.company && internship.company.name ? internship.company.name : 'Company Name Not Available'}</p>
                    <p class="text-xs text-brand-text mt-1">
                        <i class="fas fa-map-marker-alt mr-1"></i>
                        ${internship.location || 'Remote'}
                    </p>
                </div>
                
                <p class="text-sm text-brand-text mb-4" style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                    ${internship.description.substring(0, 100)}...
                </p>
                
                <div class="flex justify-between items-center mb-4">
                    <span class="text-sm font-medium text-brand-heading">
                        ${internship.stipend && internship.stipend !== '0' ? `â‚¹${internship.stipend}/month` : 'Unpaid'}
                    </span>
                    <span class="text-xs text-brand-text">
                        ${internship.duration}
                    </span>
                </div>
                
                <div class="flex space-x-2">
                    <button class="flex-1 bg-brand-primary text-white text-sm py-2 px-4 rounded-md hover:bg-brand-primary/90 transition-colors">
                        Apply Now
                    </button>
                    <button class="px-3 py-2 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors">
                        <i class="fas fa-share-alt text-brand-text"></i>
                    </button>
                </div>
            `;
            
            return card;
        }
    </script>
</body>
</html>